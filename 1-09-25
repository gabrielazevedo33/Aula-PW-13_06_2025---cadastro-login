<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylessheet" href="styles.css">
    <title>CRUD</title>
</head>

<body>
    <div class="container">
        <div class="header">
            <span>Cadastro de funcionarios </span>
            <button onclick="openModal()" id="new">Incluir</i</button>
        </div>
    </div>

    <div class="divTable">
        <table>
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Função</th>
                    <th>Salario</th>
                    <th class="acao">Editar</th>
                    <th class="acao">Editar</th>
                </tr>
            </thead>
        </table>
    </div>

    <div class="modal-container">
        <div class="modal">
            <form>
                <label for="m-nome">Nome</label>
                <input id="m-nome" type="text" required />

                <label for="m-funcao">Função</label>
                <input id="m-funcao" type="text" required />

                <label for="m-salario">Salário</label>
                <input id="m-salario" type="text" required />
                <button id="btnSalvar">Salvar</button>
            </form>
        </div>
    </div>

    <script src="script.js"></script>

</body>
</html>

// js

const modal = document.querySelector('.modal-container')
const tbody = document.querySelector('.tbody')
const sNome = document.querySelector('#m-nome')
const sFuncao = document.querySelector('#m-funcao')
const sSalario = document.querySelector('#m-salario')
const btnSalvar = document.querySelector('#m-salvar')

let itens
let id

function openModal(edit = false, index = 0) {
    modal.classList.add('active')

    modal.onclick = e => {
        if (e.target.className.index('modal-container') !== -1){
            modal.classList.remove('active')
        }
    }    
}

       if (edit) {
        sNome.value = itens[index].nome
        sFuncao.value = itens[index].funcao
        sSalario.value = itens[index].salario
        id = index
       } else { 
        sNome.value = ''
        sFuncao.value = ''
        sSalario.value = ''
       }

       function insertItem(item, index) {
        let tr = document.createElement('tr')

        tr.innerHTML = `
        <td>${item.nome}</td>
        <td>${item.funcao}</td>
        <td>${item.salario}</td>
        <td class= "acao">
        <button onclick= "editItem(${index})"><i class= 'bx bx-edit></i><button>
        </td>
        `
        tbody.appendChild(tr)
       }

       btnSalvar.onclick = e => {

        if (sNome.value == '' || sFuncao.value == '' || sSalario.value == '') {
            return
        }

        e.preventDefault();

        if (id !== undefined) {
            itens[id].nome = sNome.value
            itens[id].funcao = sFuncao.value
            itens[id].salario = sSalario.value
        } else {
            itens.push({'nome' : sNome.value, 'funcao': sFuncao.value,'salario': sSalario.value})}

        }


        setItensBD()

        modal.classList.remove('active')
        loadItens()
        id = undefined
    
    
    function loadItens() {
        itens = getItensBD()
        tbody.innerHTML = ''
        itens.forEach((item, index) => {
            insertItem(item, index)

    })

}

const getItensBD = () => JSON.parse(localStorage.getItem('dbfunc')) ??
[]
const setItensBD = () => localStorage.setItem('dbfunc', JSON.stringify(itens))

loadItens()

const modal = document.querySelector('.modal-container')


       
